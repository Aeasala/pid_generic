Version 4
SHEET 1 1816 700
WIRE -32 -704 -192 -704
WIRE -656 -608 -752 -608
WIRE -480 -608 -576 -608
WIRE -416 -608 -480 -608
WIRE -304 -608 -352 -608
WIRE -192 -608 -192 -704
WIRE -192 -608 -304 -608
WIRE -192 -576 -192 -608
WIRE -304 -560 -304 -608
WIRE -192 -496 -304 -496
WIRE -480 -448 -480 -608
WIRE -304 -448 -304 -496
WIRE 80 -400 -32 -400
WIRE 416 -400 304 -400
WIRE 192 -384 160 -400
WIRE 192 -384 224 -400
WIRE -528 -368 -832 -368
WIRE 544 -128 496 -128
WIRE 672 -128 624 -128
WIRE -240 -112 -320 -112
WIRE -128 -112 -160 -112
WIRE -64 -112 -128 -112
WIRE 96 -112 16 -112
WIRE -768 -96 -960 -96
WIRE -960 -32 -960 -96
WIRE -944 -32 -960 -32
WIRE -832 -32 -832 -368
WIRE -832 -32 -864 -32
WIRE -768 -32 -832 -32
WIRE -464 -32 -544 -32
WIRE 336 -16 240 -16
WIRE 496 -16 496 -128
WIRE 496 -16 416 -16
WIRE 544 -16 496 -16
WIRE -128 0 -128 -112
WIRE -48 0 -128 0
WIRE 672 0 672 -128
WIRE 672 0 608 0
WIRE 704 0 672 0
WIRE 736 0 704 0
WIRE 880 0 816 0
WIRE 96 16 96 -112
WIRE 96 16 16 16
WIRE 240 16 240 -16
WIRE 240 16 96 16
WIRE 544 16 496 16
WIRE -240 32 -320 32
WIRE -128 32 -160 32
WIRE -48 32 -128 32
WIRE -128 64 -128 32
WIRE 496 64 496 16
WIRE -960 96 -960 -32
WIRE -576 96 -960 96
WIRE -464 96 -464 -32
WIRE -464 96 -576 96
WIRE -320 128 -320 32
WIRE 544 128 496 128
WIRE 672 128 608 128
WIRE 496 176 496 128
WIRE 544 176 496 176
WIRE 672 176 672 128
WIRE 672 176 624 176
WIRE 880 176 880 0
WIRE 1040 176 880 176
WIRE 1120 176 1040 176
WIRE 1216 176 1200 176
WIRE 1248 176 1216 176
WIRE 1264 176 1248 176
WIRE 1360 176 1344 176
WIRE 1440 176 1360 176
WIRE 1568 176 1520 176
WIRE 1680 176 1568 176
WIRE 1760 176 1680 176
WIRE -320 256 -320 208
WIRE -128 256 -128 144
WIRE 1040 256 1040 176
WIRE 1072 256 1040 256
WIRE 1360 256 1360 176
WIRE 1392 256 1360 256
WIRE 240 272 240 16
WIRE 336 272 240 272
WIRE 496 272 496 176
WIRE 496 272 416 272
WIRE 544 272 496 272
WIRE 1248 272 1248 176
WIRE 1248 272 1136 272
WIRE 1568 272 1568 176
WIRE 1568 272 1456 272
WIRE 672 288 672 176
WIRE 672 288 608 288
WIRE 704 288 672 288
WIRE 736 288 704 288
WIRE 880 288 880 176
WIRE 880 288 816 288
WIRE 1072 288 1024 288
WIRE 1392 288 1344 288
WIRE 544 304 496 304
WIRE 496 352 496 304
WIRE 1024 352 1024 288
WIRE 1344 352 1344 288
WIRE 544 448 496 448
WIRE 672 448 624 448
WIRE 240 560 240 272
WIRE 272 560 240 560
WIRE 368 560 336 560
WIRE 496 560 496 448
WIRE 496 560 448 560
WIRE 544 560 496 560
WIRE 672 576 672 448
WIRE 672 576 608 576
WIRE 704 576 672 576
WIRE 736 576 704 576
WIRE 880 576 880 288
WIRE 880 576 816 576
WIRE 544 592 496 592
WIRE 496 640 496 592
FLAG -320 256 0
FLAG -128 256 0
FLAG 192 -384 0
FLAG 416 -400 P7V
FLAG -32 -400 N7V
FLAG -16 -16 P7V
FLAG -16 48 N7V
FLAG -320 32 setpoint
FLAG -320 -112 Vfb
FLAG 576 -32 P7V
FLAG 576 32 N7V
FLAG 496 64 0
FLAG 576 256 P7V
FLAG 576 320 N7V
FLAG 496 352 0
FLAG 576 544 P7V
FLAG 576 608 N7V
FLAG 496 640 0
FLAG 1104 240 P7V
FLAG 1104 304 N7V
FLAG 1024 352 0
FLAG 1424 240 P7V
FLAG 1424 304 N7V
FLAG 1344 352 0
FLAG -768 -160 0
FLAG -768 32 P7V
FLAG -576 160 0
FLAG -544 -160 P7V
FLAG -480 -352 0
FLAG -304 -448 0
FLAG -752 -608 P7V
FLAG -32 -704 Vfb
FLAG -544 32 out
FLAG 1216 176 out
FLAG 704 0 vprop
FLAG 704 288 vint
FLAG 704 576 vder
FLAG 1680 176 out_inv
SYMBOL voltage -320 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2
SYMBOL OpAmps\\AD820 -16 -48 R0
SYMATTR InstName Uerror
SYMBOL res -144 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -144 48 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL voltage 320 -400 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 7
SYMBOL voltage 176 -400 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 7
SYMBOL res -144 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res 32 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -96 25 VTop 2
SYMATTR InstName R4
SYMATTR Value {10k/max((errin_div-1),0.0001)}
SYMBOL OpAmps\\AD820 576 -64 R0
SYMATTR InstName Uprop
SYMBOL res 640 -144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {10k*Kp}
SYMBOL res 432 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL OpAmps\\AD820 576 224 R0
SYMATTR InstName Uint
SYMBOL res 432 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL cap 608 112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 -8 -21 VTop 0
SYMATTR InstName C1
SYMATTR Value {1/(10k*Ki)}
SYMBOL OpAmps\\AD820 576 512 R0
SYMATTR InstName Uprop1
SYMBOL res 640 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Kd*10k}
SYMBOL res 464 544 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL cap 336 544 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 38 28 VTop 1
SYMATTR InstName C2
SYMATTR Value {Kd*10µ}
SYMBOL res 832 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL res 832 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL res 832 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL OpAmps\\AD820 1104 208 R0
SYMATTR InstName Usum
SYMBOL res 1216 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL OpAmps\\AD820 1424 208 R0
SYMATTR InstName Uinv
SYMBOL res 1536 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res 1360 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res 640 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL Misc\\NE555 -656 -64 R0
SYMATTR InstName U1
SYMBOL cap -560 160 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C3
SYMATTR Value 220n
SYMBOL res -848 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 200
SYMBOL nmos -528 -448 R0
SYMATTR InstName M1
SYMATTR Value AP9465GEM
SYMBOL ind -672 -592 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 47µ
SYMBOL diode -416 -592 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL cap -320 -560 R0
SYMATTR InstName C4
SYMATTR Value 1µ
TEXT -384 280 Left 2 !.tran 10m startup uic
TEXT 656 -256 Left 2 !.param Kp 20000
TEXT 656 -232 Left 2 !.param Ki 20000
TEXT 656 -208 Left 2 !.param Kd 100000
TEXT 656 -368 Left 2 !.param errin_div 20
